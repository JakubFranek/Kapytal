# Importing Transactions from CSV

Kapytal allows you to bulk-import transactions from a CSV file using two helper files:

- Import Profile JSON – describes how the transaction CSV is structured
- Payee Mapping JSON (*optional*) – for automatic [Payee](./glossary.md#payee-icon) renaming

This guide explains how to prepare these files and run the import.

## 1. Prepare a Cash Account

Before importing, make sure there is at least one [Cash Account](./glossary.md#cash-account-icon) created in your [data file](./glossary.md#data-file).
All imported transactions will be added into the selected account. The [Currency](./glossary.md#currency-icon) of the amounts inside the CSV is assumed to match the Currency of the Cash Account.

## 2. Prepare Your CSV File

Export a CSV file from your bank or financial service.

One transaction per row is expected. The details of how the CSV will be interpreted are set in the Import Profile JSON. All transactions in the file will be imported - remove the ones you don't want manually before the import in a text editor, or after the import in Kapytal.

## 3. Create an Import Profile JSON

The import profile tells Kapytal how to read your CSV.

Example:

```json
{
  "column_delimiter": ";",
  "quote_char": "\"",
  "encoding": "utf-8-sig",
  "has_header": true,
  "columns": {
    "date": {
      "index": 0,
      "format": "%d. %m. %Y"
    },
    "description": {
      "indices": [4, 10],
      "join_with": "; "
    },
    "amount": {
      "index": 15,
      "decimal_separator": ",",
      "thousand_separator": "\u00A0"
    },
    "iban": {
      "index": 7
    },
    "payee": {
      "indices": [8, 9],
      "fallback": "Unknown"
    },
    "category": {
      "constant": "Unknown"
    },
    "tag": {
      "constant": "imported"
    }
  }
}
```

### Import Profile JSON fields

- `column_delimiter`
  - String symbol used for column separation.
- `quote_char`
  - String symbol used to quote fields in the CSV.
  - Many CSVs are organized like this: `"ABC", "1,2345"`, in such case, the `quote_char` is `"` and the `column_delimiter` is `,`, and without the `quote_char`, the numerical value would be parsed incorrectly, because it contains the `column_delimiter`.
- `encoding`
  - Any standard or aliased encoding name recognized by Python’s `codecs` module can be used, such as `utf-8`.
- `has_header`
  - `true` if the CSV contains single row header, `false` if not
- `columns`
  - Contains a sub-dictionary of following fields:
    - `date`
      - Requires sub-field `format`, specifying a Python `strftime` format string (such as `"%d.%m.%Y"`).
    - `description`
    - `amount`
      - Optional sub-fields are `decimal_separator` and `thousand_separator`.
      - Negative numbers are expected for outgoing transactions, positive numbers for incoming transactions.
    - `iban`
    - `payee`
    - `category`
    - `tag`
  - All of the `columns` fields must contain exactly one of these sub-fields:
    - `index`
      - Reads the value from a single CSV column at the given index (0-based).
    - `indices`
      - Reads values from multiple CSV columns, which are supplied in a list.
      - How the values are used depends on optional sub-fields:
        - With `join_with`: combine all non-empty columns into one string.
        - Without `join_with`: pick the first non-empty column.
        - With `fallback` string: use the fallback string if all columns are empty.
    - `constant`
      - Ignores CSV content entirely and always uses a fixed value.

### Tips

- If the CSV does not contain IBAN data, you can use `"iban": {"constant": ""}` to ignore this functionality
- CSVs exported from bank data usually does not contain [Category](./glossary.md#category-icon) data, so `category` column is usually a `constant`. If the Category exists already, ensure it is of type *Dual-Purpose*, as the CSV data could contain both [Income](./glossary.md#income-icon) and [Expense](./glossary.md#expense-icon) [Cash Transaction](./glossary.md#cash-transaction).
- You can use a `constant` tag name to tag the imported transactions so that you know that they were imported.
- You can use a `indices` sub-field for the `description` column along with a `join_with` sub-field to combine strings from multiple CSV columns. This is handy for saving multiple message fields, such as the "message for receiver", "reference" etc.
- If you import CSVs generated by various banks, you will likely need a special Import Profile JSON for each bank, as each bank could produce different format of the CSV data. Save the Import Profiles with a descriptive file name.

## 4. Create a Payee Mapping JSON (optional)

Use this file to rename a Payee during import. This can be handy if the Payee name in Kapytal does not exactly match the name in the CSV file.

Example:

```json
{
  "McRonalds inc.": "McRonalds",
  "McRonaldsPrague": "McRonalds",
  "Local_Shop": "Local Shop"
}
```

If the left-hand name is encountered during importing, the right-hand name is used instead.

## 5. Run the Import

In the application:

1. Open Import Transactions from `File->Import Transaction` menu
1. Select the Cash Account where the transactions should be added
1. Select your CSV file
1. Select your Import Profile JSON
1. (*optional*) Select your Payee Mapping JSON
1. Confirm the import

What happens during import:

- If a transaction’s IBAN matches another Cash Account, it is treated as a [Cash Transfer](./glossary.md#cash-transfer-icon), otherwise it becomes a Cash Transaction.
- If an error is encountered, the error is reported and importing stops. All transactions imported up until this point are kept. Please save [backup](./glossary.md#backups) your data file before importing!

## 6. Review Imported Transactions

After the import:

- The Import Transactions dialog closes automatically.
- All imported transactions appear in the [Transaction Table](./glossary.md#transaction-table-icon).
- You can now review, edit, delete or categorize the transactions as normal.
